(self.webpackChunkjson_bot_ui=self.webpackChunkjson_bot_ui||[]).push([[8253],{8253:function(t,i,o){"use strict";o.r(i),o.d(i,{BotSetupPageModule:function(){return T}});var e=o(1116),n=o(1462),s=o(6611),r=o(2782),a=o(4762),c=o(8619),h=o(6907),l=o(2693),u=o(1779),g=o(8993);function d(t,i){if(1&t){const t=c.EpF();c.TgZ(0,"div",5),c.TgZ(1,"ion-icon",6),c.NdJ("click",function(i){return c.CHM(t),c.oxw().onDeleteBot(i)}),c.qZA(),c.qZA()}}function m(t,i){if(1&t&&(c.TgZ(0,"ion-row"),c.TgZ(1,"ion-col"),c._uU(2),c.ALo(3,"date"),c.qZA(),c.TgZ(4,"ion-col"),c._uU(5),c.qZA(),c.TgZ(6,"ion-col"),c._uU(7),c.qZA(),c.qZA()),2&t){const t=i.$implicit,o=c.oxw(2);c.xp6(2),c.Oqu(c.xi3(3,3,t.D,"dd/MM HH:mm")),c.xp6(3),c.Oqu(o.shortNumberDisplay(t.Q,1,3)),c.xp6(2),c.Oqu(t.P)}}function v(t,i){if(1&t){const t=c.EpF();c.TgZ(0,"div"),c.TgZ(1,"ion-item",7),c.TgZ(2,"span",0),c.TgZ(3,"ion-chip",8),c.NdJ("click",function(i){return c.CHM(t),c.oxw().onShowOutput(i)}),c._UZ(4,"ion-icon",9),c.TgZ(5,"ion-label"),c._uU(6,"transactions "),c.qZA(),c._UZ(7,"ion-icon",10),c.qZA(),c.qZA(),c.TgZ(8,"span",5),c.TgZ(9,"ion-chip",8),c.NdJ("click",function(i){return c.CHM(t),c.oxw().onDeleteOutput(i)}),c._UZ(10,"ion-icon",11),c.TgZ(11,"ion-label"),c._uU(12,"init bot "),c.qZA(),c._UZ(13,"ion-icon",10),c.qZA(),c.qZA(),c.qZA(),c.TgZ(14,"ion-item"),c.TgZ(15,"p"),c._uU(16),c.qZA(),c.qZA(),c.TgZ(17,"ion-grid",12),c.TgZ(18,"ion-row"),c.TgZ(19,"ion-col"),c._uU(20,"Date"),c.qZA(),c.TgZ(21,"ion-col"),c._uU(22,"Qty"),c.qZA(),c.TgZ(23,"ion-col"),c._uU(24,"Price"),c.qZA(),c.qZA(),c.YNc(25,m,8,6,"ion-row",13),c.qZA(),c.qZA()}if(2&t){const t=c.oxw();c.xp6(16),c.lnq("Q ",t.shortNumberDisplay(t.dNetQuantity,1,3),", $ ",t.dNetInvestment.toFixed(2),", Avg ",t.dAvgPrice.toFixed(7),""),c.xp6(9),c.Q6J("ngForOf",t.oT)}}const f=["","K","M","B","T","Q"],p=[{path:"",component:(()=>{class t{constructor(t,i,o,e,n){this.oLocation=t,this.oAPIService=i,this.http=o,this.router=e,this.oStorage=n,this.sExchange="<notSet>",this.sStrategy="<notSet>",this.sKey=void 0,this.sTitle=void 0,this.bLoaded=!1,this.bNew=!0,this.oT=[],this.dNetInvestment=0,this.dNetQuantity=0,this.dAvgPrice=0;var s=this.oLocation.getState();console.log(s),this.bNew=s.isNew,null==s||s.isNew||(this.sStrategy=s.Strategy,this.sExchange=s.Exchange,this.sKey=this.getKey(s),console.log(this.sKey),this.oP=s,this.updateValues(s)),null!=s&&s.isNew&&(this.sStrategy=s.Strategy,this.sExchange=s.Exchange,console.log("New Bot Configuration:",this.sStrategy)),this.sTitle=this.getTitle(s)}onBack(){return(0,a.mG)(this,void 0,void 0,function*(){this.oLocation.back()})}getKey(t){return this.sExchange+"_"+this.sStrategy+"_"+t.A+t.B}getTitle(t){return this.sExchange+"_"+this.sStrategy}shortNumberDisplay(t,i,o){if(0===t)return t;const e=Math.floor(Math.log10(Math.abs(t))/3),n=f[e];return(t/Math.pow(10,3*e)).toLocaleString(void 0,{minimumFractionDigits:i,maximumFractionDigits:o})+n}readParameters(t){return(0,a.mG)(this,void 0,void 0,function*(){this.oP=yield this.oStorage.get(t),this.updateValues(this.oP)})}ngOnInit(){this.http.get("/assets/strategy-"+this.sStrategy+".json").subscribe(t=>(0,a.mG)(this,void 0,void 0,function*(){this.formData=t,this.updateValues(this.oP)}))}updateValues(t){if(void 0===t||null==t||null==this.formData)return;if(this.bLoaded)return;this.bLoaded=!0,console.log(this.oP);let i=this.formData.controls.length,o=Object.keys(t);for(var e=0;e<o.length;e++){let n=o[e];for(let o=0;o<i;o++)this.formData.controls[o].name==n&&(this.formData.controls[o].value=t[n])}console.log(this.formData.controls)}onDeleteBot(t){return(0,a.mG)(this,void 0,void 0,function*(){yield this.oAPIService.send2ServerPDelete("bot-config/"+this.getKey(this.oP)).then(t=>(0,a.mG)(this,void 0,void 0,function*(){void 0!==this.sKey&&(yield this.oStorage.remove(this.sKey)),yield this.router.navigateByUrl("bot-list")}))})}onDeleteOutput(t){return(0,a.mG)(this,void 0,void 0,function*(){console.log(t),yield this.oAPIService.send2ServerPDelete("output/"+this.getKey(this.oP))})}getDecimalPlaces(t){const i=String(t);return i.includes(".")?i.split(".")[1].length:0}onShowOutput(t){return(0,a.mG)(this,void 0,void 0,function*(){this.oT=[],yield this.oAPIService.send2ServerP("output/"+this.getKey(this.oP)).then(t=>(0,a.mG)(this,void 0,void 0,function*(){if(void 0===t||void 0===t.T)return;let i=t.T.length;this.dNetInvestment=0,this.dNetQuantity=0;for(var o=0;o<i;o++){if("FILLED"!=t.T[o].Status)continue;let i=t.T[o].D,e=this.getDecimalPlaces(t.T[o].Q),n=this.getDecimalPlaces(t.T[o].P);e=n<3?Math.min(e+n,7):Math.min(e,0),"S"==t.T[o].Dir&&(t.T[o].Q=-1*t.T[o].Q),this.dNetInvestment+=t.T[o].P*t.T[o].Q,this.dNetQuantity+=t.T[o].Q,this.oT.push({D:i,Q:t.T[o].Q.toFixed(e),P:t.T[o].P.toFixed(Math.min(n,8)),$:Number(t.T[o].Q)*Number(t.T[o].P)})}console.log("Total $",this.dNetInvestment),console.log("Total Qty",this.dNetQuantity),0!=this.dNetQuantity&&(this.dAvgPrice=this.dNetInvestment/this.dNetQuantity),console.log("Avg $",this.dAvgPrice)}))})}onFormSubmit(t){return(0,a.mG)(this,void 0,void 0,function*(){this.bNew&&(t.Exchange=this.sExchange),console.log(t.Exchange,this.sExchange),this.sKey=this.getKey(t),console.log(this.sKey),this.oStorage.set(this.sKey,t),console.log(t),yield this.oAPIService.send2ServerP("bot-config",!0,t),yield this.router.navigateByUrl("bot-list")})}}return t.\u0275fac=function(i){return new(i||t)(c.Y36(e.Ye),c.Y36(h.D),c.Y36(l.eN),c.Y36(r.F0),c.Y36(u.V))},t.\u0275cmp=c.Xpm({type:t,selectors:[["app-bot-setup"]],decls:11,vars:4,consts:[["slot","start"],["slot","end",4,"ngIf"],[1,"ion-padding"],[3,"jsonFormData","formSubmission"],[4,"ngIf"],["slot","end"],["name","trash",3,"click"],["item-end",""],[3,"click"],["name","albums","color","primary"],["color","primary"],["name","close","color","primary"],[1,"ion-margin"],[4,"ngFor","ngForOf"]],template:function(t,i){1&t&&(c.TgZ(0,"ion-header"),c.TgZ(1,"ion-toolbar"),c.TgZ(2,"ion-title"),c._uU(3),c.qZA(),c.TgZ(4,"ion-buttons",0),c._UZ(5,"ion-back-button"),c.qZA(),c.YNc(6,d,2,0,"div",1),c.qZA(),c.qZA(),c.TgZ(7,"ion-content",2),c.TgZ(8,"div"),c.TgZ(9,"app-json-form",3),c.NdJ("formSubmission",function(t){return i.onFormSubmit(t)}),c.qZA(),c.qZA(),c.YNc(10,v,26,4,"div",4),c.qZA()),2&t&&(c.xp6(3),c.Oqu(i.sTitle),c.xp6(3),c.Q6J("ngIf",void 0!==i.sKey),c.xp6(3),c.Q6J("jsonFormData",i.formData),c.xp6(1),c.Q6J("ngIf",void 0!==i.sKey))},directives:[s.Gu,s.sr,s.wd,s.Sm,s.oU,s.cs,e.O5,s.W2,g.u,s.gu,s.Ie,s.hM,s.Q$,s.jY,s.Nd,s.wI,e.sg],pipes:[e.uU],styles:["ion-col[_ngcontent-%COMP%]{text-align:right}ion-icon[_ngcontent-%COMP%]{margin:10px;font-size:large}"]}),t})()}];let Z=(()=>{class t{}return t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=c.oAB({type:t}),t.\u0275inj=c.cJS({imports:[[r.Bz.forChild(p)],r.Bz]}),t})();var y=o(6737);let T=(()=>{class t{}return t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=c.oAB({type:t}),t.\u0275inj=c.cJS({imports:[[e.ez,n.UX,s.Pc,Z,l.JF,y.G]]}),t})()}}]);